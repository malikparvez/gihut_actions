# This is a generic workflow for releasing a Puppet module.
# It requires that the caller sets `secrets: inherit` to ensure
# that secrets are visible from steps in this workflow.
name: "Module Release"

on:
  workflow_dispatch:

jobs:
  release:
    name: "Release"
    runs-on: "ubuntu-latest"

    steps:

      - name: "Checkout"
        uses: "actions/checkout@v4"
        with:
          ref: "${{ github.ref }}"
          clean: true
          fetch-depth: 0

      - name: "Get version"
        id: "get_version"
        run: |
          echo "version=$(jq --raw-output '.version | gsub("[^0-9.]"; "")' metadata.json)" >> $GITHUB_OUTPUT

      - name: "Check version"
        if: ${{ steps.get_version.outputs.version }}
        run: |
          echo "Version is empty. Exiting workflow."
          exit 1

      - name: "print version"
        run: |
          echo ${{ steps.get_version.outputs.version }}

